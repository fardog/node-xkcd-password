#!/usr/bin/env node
/**
 * xkcd-password commandline utility.
 *
 * @since 0.0.1
 */
'use strict';

var opts = require('nomnom')
  .script('xkcd-password')
  .option('numWords', {
    abbr: 'n',
    default: 4,
    help: 'The number of words to generate for your password.'
  })
  .option('minLength', {
    abbr: 'm',
    default: 5,
    help: 'Minimum lengh of words chosen for the generated password.'
  })
  .option('maxLength', {
    abbr: 'x',
    default: 8,
    help: 'Maximum length of words chosen for the generated password.'
  })
  .option('wordFile', {
    abbr: 'f',
    default: null,
    help: 'The newline-delimited list of words to be used as the source.'
  })
  .option('separator', {
    abbr: 's',
    default: ' ',
    type: "string",
    help: 'The separator character to use between words when output to the console.'
  })
  .option('version', {
    flag: true,
    help: 'print version and exit',
    callback: function() {
      var data = require('../package.json');
      return "version " + data.version;
    }
  })
  .parse();

var xkcdPassword = require('../');
var pw = null;

// use the word file if we were given one
if (opts.wordFile) {
  pw = new xkcdPassword().initWithWordFile(opts.wordFile);
}
else {
  pw = new xkcdPassword();
}

// generate the password, output the result
pw.generate(opts.numWords, opts.minLength, opts.maxLength, function(err, result) {
  if (err) {
    console.error("There was an error generating your password.");
    console.error(err);
    throw err;
  }
  else {
    console.log(result.join(opts.separator));
  }
});
